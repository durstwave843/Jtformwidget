<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 10px;
      }
      #status {
        padding: 10px;
        margin: 10px 0;
        background: #f0f0f0;
        border: 1px solid #ccc;
      }
      .debug {
        font-family: monospace;
        padding: 10px;
        background: #fffaf0;
        border: 1px solid #ddd;
        white-space: pre-wrap;
        margin: 10px 0;
        max-height: 200px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <h3>JotForm Test Widget</h3>
    
    <div id="status">Status: Initializing...</div>
    
    <div id="form-values" class="debug">No values received yet...</div>
    
    <div id="direct-values" class="debug">No direct values received yet...</div>
    
    <div id="log" class="debug">Logs will appear here...</div>
    
    <script>
      // Simple logging function
      function log(message) {
        var logElement = document.getElementById('log');
        var time = new Date().toTimeString().split(' ')[0];
        logElement.innerHTML = time + ': ' + message + '\n' + logElement.innerHTML;
      }
      
      // Update status
      function updateStatus(message) {
        document.getElementById('status').innerHTML = 'Status: ' + message;
      }
      
      // Display any data we receive
      function displayData(data, elementId) {
        var element = document.getElementById(elementId);
        var content = '';
        
        try {
          if (typeof data === 'object') {
            content = JSON.stringify(data, null, 2);
          } else {
            content = String(data);
          }
        } catch (e) {
          content = 'Error displaying data: ' + e.message;
        }
        
        element.innerHTML = content;
      }

      // Initialize when script loads
      log('Script loaded, waiting for JotForm API...');
      
      // Subscribe to ready event
      JFCustomWidget.subscribe('ready', function() {
        log('Ready event received!');
        updateStatus('Connected to JotForm');
        
        // Get widget settings
        var settings = JFCustomWidget.getWidgetSettings();
        log('Widget settings: ' + JSON.stringify(settings));
        
        // Listen for form value changes
        JFCustomWidget.subscribe('formValueChanged', function(data) {
          log('Form value changed: ' + JSON.stringify(data));
          displayData(data, 'form-values');
        });
        
        // Simple one-time direct check
        setTimeout(function() {
          log('Directly checking field values...');
          
          var qid = new URLSearchParams(window.location.search).get('qid') || '';
          log('Question ID: ' + qid);
          
          // Try several field formats
          var fieldNames = ['typeA10', 'q' + qid + '_typeA10', 'input_10', 'q3_typeA'];
          
          fieldNames.forEach(function(fieldName) {
            log('Checking field: ' + fieldName);
            
            JFCustomWidget.getFieldsValueByName([fieldName], function(response) {
              log('Response for ' + fieldName + ': ' + JSON.stringify(response));
              displayData(response, 'direct-values');
            });
          });
        }, 2000);
        
        // Handle form submit event
        JFCustomWidget.subscribe('submit', function() {
          log('Form submit event received');
          JFCustomWidget.sendSubmit({
            valid: true,
            value: 'Test widget submission'
          });
        });
      });
    </script>
  </body>
</html>
